@(periodKey: Int, reliefsTaxAvoidance : Option[ReliefsTaxAvoidance], canSubmit: Boolean, isComplete: Boolean, backLink: Option[String])(implicit atedContext: AtedContext, messages: Messages)

@import models._
@import uk.gov.hmrc.play.views.html._
@import uk.gov.hmrc.play.views.html.helpers._
@import views.html.helpers._
@import views.html.helpers.error._
@import utils.PeriodUtils.{periodStartDate, periodEndDate}

@atedMain(
  title = Messages("ated.relief-summary.title"),
  attorney = atedContext.user.authContext.attorney) {

  @pageHeadersAndError(
    backLink, "pre-header",
    Messages("ated.choose-reliefs.subheader"),
    "property-details-summary-header",
    Messages("ated.relief-summary.header")
  )

  <p id="details-text">@Messages("ated.relief-summary.details-text",
    periodStartDate(periodKey).toString(Messages("ated.date-format")),
    periodEndDate(periodKey).toString(Messages("ated.date-format")))
  </p>

@reliefsTaxAvoidance.map { reliefData =>

  @if(reliefData.reliefs.rentalBusiness) {
    @reliefsTypeGrid(periodKey, reliefData, canSubmit, "rentalBusiness",
      reliefData.reliefs.rentalBusinessDate,
      reliefData.taxAvoidance.rentalBusinessScheme,
      reliefData.taxAvoidance.rentalBusinessSchemePromoter)
  }

  @if(reliefData.reliefs.openToPublic) {
    @reliefsTypeGrid(periodKey, reliefData, canSubmit, "openToPublic",
      reliefData.reliefs.openToPublicDate,
      reliefData.taxAvoidance.openToPublicScheme,
      reliefData.taxAvoidance.openToPublicSchemePromoter)
  }

  @if(reliefData.reliefs.propertyDeveloper) {
    @reliefsTypeGrid(periodKey, reliefData, canSubmit, "propertyDeveloper",
      reliefData.reliefs.propertyDeveloperDate,
      reliefData.taxAvoidance.propertyDeveloperScheme,
      reliefData.taxAvoidance.propertyDeveloperSchemePromoter)
  }

  @if(reliefData.reliefs.propertyTrading) {
    @reliefsTypeGrid(periodKey, reliefData, canSubmit, "propertyTrading",
      reliefData.reliefs.propertyTradingDate,
      reliefData.taxAvoidance.propertyTradingScheme,
      reliefData.taxAvoidance.propertyTradingSchemePromoter)
  }

  @if(reliefData.reliefs.lending) {
    @reliefsTypeGrid(periodKey, reliefData, canSubmit, "lending",
      reliefData.reliefs.lendingDate,
      reliefData.taxAvoidance.lendingScheme,
      reliefData.taxAvoidance.lendingSchemePromoter)
  }

  @if(reliefData.reliefs.employeeOccupation) {
    @reliefsTypeGrid(periodKey, reliefData, canSubmit, "employeeOccupation",
      reliefData.reliefs.employeeOccupationDate,
      reliefData.taxAvoidance.employeeOccupationScheme,
      reliefData.taxAvoidance.employeeOccupationSchemePromoter)
  }

  @if(reliefData.reliefs.farmHouses) {
    @reliefsTypeGrid(periodKey, reliefData, canSubmit, "farmHouses",
      reliefData.reliefs.farmHousesDate,
      reliefData.taxAvoidance.farmHousesScheme,
      reliefData.taxAvoidance.farmHousesSchemePromoter)
  }

  @if(reliefData.reliefs.socialHousing) {
    @reliefsTypeGrid(periodKey, reliefData, canSubmit, "socialHousing",
      reliefData.reliefs.socialHousingDate,
      reliefData.taxAvoidance.socialHousingScheme,
      reliefData.taxAvoidance.socialHousingSchemePromoter)
  }

@if(reliefData.reliefs.equityRelease) {
<div class="form-group">
  <div class="grid-wrapper">
    <h2 id="equity-release" class="heading-medium">@Messages("ated.relief-summary-types.equityRelease")</h2>
  </div>

  <div class="grid-wrapper row-border">
    <div class="grid grid-2-6 cya-question">
      <span class="heading-small">@Messages("ated.relief-summary.datesOfRelief")</span>
    </div>

    <div id="dates-er" class="grid grid-1-2 cya-answer">
      @reliefData.reliefs.equityReleaseDate.getOrElse(reliefData.periodStartDate).toString(Messages("ated.date-format.short"))  @Messages("ated.relief-summary.relief-end-date")
    </div>

    <div class="grid grid-1-6 cya-change" id="dates-edit-er">
      <a href="@controllers.reliefs.routes.ChooseReliefsController.editFromSummary(periodKey)" data-journey-click="ated-fronted:click:dates-edit-er">
        @Messages("ated.edit") <span class="visuallyhidden">@Messages("ated.relief-summary.datesOfRelief")</span>
      </a>
    </div>
  </div>
  @if(reliefData.taxAvoidance.equityReleaseScheme.isDefined) {
  <div class="grid-wrapper row-border">
    <div class="grid grid-2-6 cya-question">
      <span class="heading-small">@Messages("ated.relief-summary.avoidanceSchmRefNum")</span>
    </div>

    <div class="grid grid-1-2 cya-answer" id="tas-er">
      @if(canSubmit){ <span>@reliefData.taxAvoidance.equityReleaseScheme</span> } else { <span class="status">@Messages("ated.label.incomplete")</span> }
    </div>

    <div id="tas-edit-er" class="grid grid-1-6 cya-change">
      <a href="@controllers.reliefs.routes.AvoidanceSchemeBeingUsedController.editFromSummary(periodKey)" data-journey-click="ated-fronted:click:tas-edit-er">
        @Messages("ated.edit") <span class="visuallyhidden">@Messages("ated.relief-summary.avoidanceSchmRefNum")</span>
      </a>
    </div>
  </div>

  <div class="grid-wrapper row-border">
    <div class="grid grid-2-6 cya-question">
      <span class="heading-small">@Messages("ated.relief-summary.avoidanceSchmRefNum-promoter")</span>
    </div>

    <div id="tasp-er" class="grid grid-1-2 cya-answer">
      @if(canSubmit){ <span>@reliefData.taxAvoidance.equityReleaseSchemePromoter</span> } else { <span class="status">@Messages("ated.label.incomplete")</span> }
    </div>

    <div class="grid grid-1-6 cya-change" id="tasp-edit-er">
      <a href="@controllers.reliefs.routes.AvoidanceSchemeBeingUsedController.editFromSummary(periodKey)" data-journey-click="ated-fronted:click:tasp-edit-er">
        @Messages("ated.edit") <span class="visuallyhidden">@Messages("ated.relief-summary.avoidanceSchmRefNum-promoter")</span>
      </a>
    </div>
  </div>
  } else {
  <div class="grid-wrapper row-border">
    <div class="grid grid-2-6 cya-question">
      <span class="heading-small">@Messages("ated.property-details-summary.table.property-ated-details.avoidance-scheme.header")</span>
    </div>
    <div class="grid grid-1-2 cya-answer" id="avoidance-scheme-header-equityReleaseScheme-value-not-provided">@Messages("ated.property-details-summary.field-blank")</div>
    <div class="grid grid-1-6 cya-change">
      <a href="@controllers.reliefs.routes.AvoidanceSchemeBeingUsedController.editFromSummary(periodKey)" id="tas-edit-rp" data-journey-click="ated-fronted:click:tasp-edit-rb">
        @Messages("ated.edit") <span class="visuallyhidden">@Messages("ated.relief-summary.avoidanceSchmRefNum-promoter")</span>
      </a>
    </div>
  </div>
  }
  <div class="grid-wrapper row-border">
    <div class="grid grid-2-6 cya-question">
      <span class="heading-small" id="status-er">@Messages("ated.relief-summary.status")</span>
    </div>
    <div class="grid grid-1-2 cya-answer" id="status-draft-er">
      <span class="visuallyhidden">@Messages("ated.relief-summary-types.equityRelease") @Messages("ated.relief-summary.status") </span>@Messages("ated.relief-summary.draft")
    </div>
  </div>
</div>
}

}

<div class="form-group">

  <p id="ated-charge-text">@Messages("ated.relief-summary.table.ated-charge.text")</p>

  <p id="ated-charge-value"><span class="heading-xlarge form-group">
    @if(isComplete) {
      @Messages("ated.relief-summary.table.ated-charge.balance")
    } else {
      @Messages("ated.unknow-amount.text")
    }
  </span></p>

  <div class="panel-indent">
    <p>@Messages("ated.relief-summary.saved-draft.text")</p>
  </div>

</div>


<p class="margin-bottom-default">
  <a href="@controllers.reliefs.routes.ReliefsSummaryController.viewPrintFriendlyReliefReturn(periodKey)" id="print-friendly-relief-link" data-journey-click="ated-fronted:click:print-friendly-relief-link" target="_blank">
    @Messages("ated.relief-summary.print.view")
  </a>
</p>

<p class="margin-bottom-default">
  <a href="@controllers.routes.AccountSummaryController.view()" id="saved-returns-link" data-journey-click="ated-fronted:click:saved-returns-link">@Messages("ated.property-details-summary.saved-returns.link.text")</a>
</p>

<p class="margin-bottom-default">
  <a href="@controllers.reliefs.routes.ReliefsSummaryController.deleteDraft(periodKey)" id="delete-draft" data-journey-click="ated-fronted:click:delete-draft">
      @Messages("ated.property-details-summary.delete-draft.link.text")
  </a>
</p>

  @form(action=controllers.reliefs.routes.ReliefsSummaryController.continue(periodKey)) {
      @if(!isComplete){
      } else {
        @if(canSubmit) {
          <button class="button" id="submit" type="submit">@Messages("ated.relief-summary.submit")</button>
        } else {
          <p id="submit-disabled-text">@Messages("ated.relief-summary.submit-disabled-text")</p>
          <button class="button" id="submit" type="submit" disabled>@Messages("ated.relief-summary.submit")</button>
        }
      }
  }
}
